<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAATsqJRPc-fdMO9ZXeCM4bpRRH5Ag-HcVl75qhJqki4fmF0NXdrRQf4d2O1wADpKOnVxXJ6LEyeLnPLw&sensor=false"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="route.js"></script>
<script type="text/javascript">
  
  var routes = new Array
  var map
  
  function route(route, func_name) {
    if (routes[route]) {
      routes[route][func_name]();
    }
    else {
      url = build_url(route)
      $.getJSON(url, function(data) {
        routes[route] = Route.init(data);
        routes[route][func_name]();
      });
    }
  } 

  function build_url(route) {
    return "routes/" + route + ".json"
  }

  function initialize() {
    if (GBrowserIsCompatible()) {
      map = new GMap2(document.getElementById("map_canvas"));
      map.setCenter(new GLatLng(51.508721, -0.131921), 12);
      map.setUIToDefault();
    }

    $.getJSON('route_list.json', function(data) {
      $.each(data['AllRoutes'], function(i, route_name) {
        route(route_name, 'show_route');
      });
    });
  }

</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>
